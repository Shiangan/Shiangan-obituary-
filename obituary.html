<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>訃聞頁面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            background-color: #f9f9f9;
            color: #333;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }
        header {
            text-align: center;
            margin-bottom: 20px;
        }
        h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        #mainPhoto {
            width: 100%;
            height: auto;
            display: block;
            margin: 0 auto 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        #notice {
            font-size: 1.2em;
            margin-bottom: 20px;
            text-align: center;
        }
        .timeline {
            position: relative;
            padding: 20px 0;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        .timeline:before {
            content: '';
            position: absolute;
            width: 6px;
            background-color: #ddd;
            top: 0;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
        }
        .timeline-item {
            padding: 10px 40px;
            position: relative;
            background-color: inherit;
            width: 50%;
        }
        .timeline-item:nth-child(odd) {
            left: 0;
        }
        .timeline-item:nth-child(even) {
            left: 50%;
        }
        .timeline-item:before {
            content: " ";
            position: absolute;
            width: 25px;
            height: 25px;
            right: -13px;
            background-color: white;
            border: 4px solid #ddd;
            top: 15px;
            border-radius: 50%;
            z-index: 1;
        }
        .timeline-item:nth-child(even):before {
            left: -13px;
        }
        .timeline-item-content {
            padding: 20px;
            background: #f4f4f4;
            position: relative;
            border-radius: 5px;
        }
        .timeline-item-content h3 {
            margin: 0 0 10px;
            font-size: 1.2em;
        }
        .timeline-item-content p {
            margin: 0;
        }
        .carousel {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
        }
        .carousel img {
            flex: 0 0 auto;
            width: 100%;
            height: auto;
            scroll-snap-align: center;
            margin-right: 1rem;
            border-radius: 10px;
        }
        .comment {
            margin-bottom: 1rem;
            padding: 1rem;
            background-color: #f4f4f4;
            border-radius: 5px;
        }
        .comment p {
            margin: 0;
        }
        form {
            display: flex;
            flex-direction: column;
        }
        label {
            margin-top: 1rem;
        }
        input, textarea, button {
            margin-top: 0.5rem;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        button {
            background-color: #4FBDBC;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 2rem;
        }
        .donate-button {
            margin-top: 2rem;
            background-color: #f0ad4e;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
        }
        .footer {
            text-align: center;
            margin-top: 20px;
        }
        #backgroundAudio {
            display: none;
        }
    </style>
</head>
<body>
    <header>
        <h1>訃聞</h1>
    </header>
    <div class="container">
        <img id="mainPhoto" src="" alt="主照片">
        <div id="notice"></div>
        <div class="timeline" id="timeline"></div>
        <div id="memorial-photos" class="carousel"></div>
        <div id="comments">
            <h2>留言板</h2>
            <form id="commentForm">
                <label for="commentName">姓名</label>
                <input type="text" id="commentName" name="commentName" required>
                <label for="commentText">留言</label>
                <textarea id="commentText" name="commentText" required></textarea>
                <button type="submit">提交留言</button>
            </form>
            <div id="commentList"></div>
        </div>
        <a id="flowerBasketLink" href="flower-order.html" class="donate-button">致贈花籃請點選我</a>
        <div class="footer">
            <p>承辦禮儀公司：祥安生命有限公司<br>聯絡電話: 0978-583-699</p>
        </div>
    </div>

    <audio id="backgroundAudio" controls>
        <source id="audioSource" src="" type="audio/mpeg">
    </audio>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // Retrieve data from localStorage
            const deceasedName = localStorage.getItem('deceasedName');
            const gender = localStorage.getItem('gender');
            const birthDate = new Date(localStorage.getItem('birthDate')).toLocaleDateString();
            const age = localStorage.getItem('age');
            const dateOfDeath = new Date(localStorage.getItem('dateOfDeath')).toLocaleDateString();
            const mainPhoto = localStorage.getItem('mainPhoto');
            const obituaryPhotos = JSON.parse(localStorage.getItem('obituaryPhotos') || '[]');
            const placardLocation = localStorage.getItem('placardLocation');
            const funeralDate = new Date(localStorage.getItem('funeralDate')).toLocaleDateString();
            const funeralLocation = localStorage.getItem('funeralLocation');
            const memorialPhotos = JSON.parse(localStorage.getItem('memorialPhotos') || '[]');
            const audioFile = localStorage.getItem('audioFile');

            // Update the page content
            document.getElementById('mainPhoto').src = mainPhoto;
            document.getElementById('notice').innerText = `${deceasedName}（${gender === 'male' ? '男' : '女'}），享年 ${age} 歲，於 ${dateOfDeath} 逝世。`;

            const timeline = document.getElementById('timeline');
            const events = [
                { date: birthDate, event: '出生' },
                { date: dateOfDeath, event: '逝世' },
                { date: funeralDate, event: `告別式在 ${funeralLocation} 舉行` }
            ];

            if (placardLocation) {
                events.push({ date: '', event: `靈位位置: ${placardLocation}` });
            }

            events.forEach((e, index) => {
                const item = document.createElement('div');
                item.className = 'timeline-item';
                item.innerHTML = `<div class="timeline-item-content"><h3>${e.event}</h3><p>${e.date}</p></div>`;
                timeline.appendChild(item);
            });

            const memorialPhotosContainer = document.getElementById('memorial-photos');
            memorialPhotos.forEach(photo => {
                const img = document.createElement('img');
                img.src = photo;
                                memorialPhotosContainer.appendChild(img);
            });

            const commentsContainer = document.getElementById('commentList');
            const comments = JSON.parse(localStorage.getItem('comments') || '[]');
            comments.forEach(comment => {
                const commentDiv = document.createElement('div');
                commentDiv.className = 'comment';
                commentDiv.innerHTML = `
                    <div class="comment-name">${comment.name}</div>
                    <div class="comment-text">${comment.text}</div>
                `;
                commentsContainer.appendChild(commentDiv);
            });

            // Play background music if available
            if (audioFile) {
                const audio = document.getElementById('backgroundAudio');
                document.getElementById('audioSource').src = audioFile;
                audio.load();
                audio.play();
            }
        });

        // Function to handle comment submission
        document.getElementById('commentForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('commentName').value;
            const text = document.getElementById('commentText').value;
            if (name && text) {
                const comments = JSON.parse(localStorage.getItem('comments') || '[]');
                comments.push({ name, text });
                localStorage.setItem('comments', JSON.stringify(comments));

                const commentsContainer = document.getElementById('commentList');
                const commentDiv = document.createElement('div');
                commentDiv.className = 'comment';
                commentDiv.innerHTML = `
                    <div class="comment-name">${name}</div>
                    <div class="comment-text">${text}</div>
                `;
                commentsContainer.appendChild(commentDiv);

                // Clear form fields
                document.getElementById('commentForm').reset();
            }
        });
    </script>
</body>
</html>

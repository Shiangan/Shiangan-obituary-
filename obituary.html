<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>訃聞頁面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            background-color: #f9f9f9;
            color: #333;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }
        header {
            text-align: center;
            margin-bottom: 20px;
        }
        h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        #mainPhoto {
            width: 100%;
            height: auto;
            display: block;
            margin: 0 auto 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        #notice {
            font-size: 1.2em;
            margin-bottom: 20px;
            text-align: center;
        }
        .timeline {
            position: relative;
            padding: 20px 0;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        .timeline:before {
            content: '';
            position: absolute;
            width: 6px;
            background-color: #ddd;
            top: 0;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
        }
        .timeline-item {
            padding: 10px 40px;
            position: relative;
            background-color: inherit;
            width: 50%;
        }
        .timeline-item:nth-child(odd) {
            left: 0;
        }
        .timeline-item:nth-child(even) {
            left: 50%;
        }
        .timeline-item:before {
            content: " ";
            position: absolute;
            width: 25px;
            height: 25px;
            right: -17px;
            background-color: #4FBDBC;
            border: 4px solid #ff9f55;
            top: 15px;
            border-radius: 50%;
            z-index: 1;
        }
        .timeline-item:nth-child(even):before {
            left: -16px;
        }
        .carousel img {
            width: 100%;
            height: auto;
            margin: 10px 0;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .footer {
            text-align: center;
            margin-top: 20px;
        }
        #comments {
            margin-top: 20px;
        }
        #comments h2 {
            margin-bottom: 10px;
        }
        #commentForm {
            margin-bottom: 20px;
        }
        #commentForm label {
            display: block;
            margin-bottom: 5px;
        }
        #commentForm input, #commentForm textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        #commentForm button {
            padding: 10px 20px;
            background-color: #4FBDBC;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>訃聞</h1>
        </header>
        <img id="mainPhoto" src="" alt="主照片">
        <div id="notice"></div>
        <div class="timeline" id="timeline"></div>
        <div id="memorial-photos" class="carousel"></div>
        <div id="comments">
            <h2>留言板</h2>
            <form id="commentForm">
                <label for="commentName">姓名</label>
                <input type="text" id="commentName" name="commentName" required>
                <label for="commentText">留言</label>
                <textarea id="commentText" name="commentText" required></textarea>
                <button type="submit">提交留言</button>
            </form>
        </div>
        <a id="flowerBasketLink" href="flower-order.html">致贈花籃請點選我</a>
        <div class="footer">
            <p>承辦禮儀公司：祥安生命有限公司
                聯絡電話: 0978-583-699</p>
        </div>
    </div>

    <audio id="backgroundAudio" controls>
        <source id="audioSource" src="" type="audio/mpeg">
    </audio>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // Retrieve data from localStorage
            const deceasedName = localStorage.getItem('deceasedName');
            const gender = localStorage.getItem('gender');
            const birthDate = new Date(localStorage.getItem('birthDate')).toLocaleDateString();
            const age = localStorage.getItem('age');
            const dateOfDeath = new Date(localStorage.getItem('dateOfDeath')).toLocaleDateString();
            const mainPhoto = localStorage.getItem('mainPhoto');
            const obituaryPhotos = JSON.parse(localStorage.getItem('obituaryPhotos') || '[]');
            const placardLocation = localStorage.getItem('placardLocation');
            const funeralDate = new Date(localStorage.getItem('funeralDate')).toLocaleDateString();
            const funeralLocation = localStorage.getItem('funeralLocation');
            const memorialPhotos = JSON.parse(localStorage.getItem('memorialPhotos') || '[]');
            const audioFile = localStorage.getItem('audioFile');

            // Update the page content
            document.getElementById('mainPhoto').src = mainPhoto;
            document.getElementById('notice').innerText = `${deceasedName}（${gender === 'male' ? '男' : '女'}），享年 ${age} 歲，於 ${dateOfDeath} 逝世。`;

            const timeline = document.getElementById('timeline');
            const events = [
                { date: birthDate, event: '出生' },
                { date: dateOfDeath, event: '逝世' },
                { date: funeralDate, event: `告別式在 ${funeralLocation} 舉行` }
            ];

            if (placardLocation) {
                events.push({ date: '', event: `靈位位置: ${placardLocation}` });
            }

            events.forEach((e, index) => {
                const item = document.createElement('div');
                item.className = 'timeline-item';
                item.innerHTML = `<h3>${e.event}</h3><p>${e.date}</p>`;
                timeline.appendChild(item);
            });

            const memorialPhotosContainer = document.getElementById('memorial-photos');
            memorialPhotos.forEach(photo => {
                const img = document.createElement('img');
                img.src = photo;
                memorialPhotosContainer.appendChild(img);
            });

            const commentsContainer = document.getElementById('comments');
            const comments = JSON.parse(localStorage.getItem('comments') || '[]');
            comments.forEach(comment => {
                const p = document.createElement('p');
                p.innerText = comment;
                commentsContainer.appendChild(p);
            });

            // Play background music if available
            if (audioFile) {
                const audio = document.getElementById('backgroundAudio');
                document.getElementById('audioSource').src = audioFile;
                audio.load();
                audio.play();
            }

            // Handle comment form submission
            document.getElementById('commentForm').addEventListener('submit', (event) => {
                event.preventDefault();
                const commentName = document.getElementById('commentName').value;
                const commentText = document.getElementById('commentText').value;

                const comments = JSON.parse(localStorage.getItem('comments') || '[]');
                comments.push({ name: commentName, text: commentText });
                localStorage.setItem('comments', JSON.stringify(comments));

                const p = document.createElement('p');
                p.innerText = `${commentName}: ${commentText}`;
                commentsContainer.appendChild(p);

                document.getElementById('commentForm').reset();
            });
        });
    </script>
</body>
</html>
